<div th:replace="core/admin-lte-3/workspace/ocp_admin/report/script/api"></div>
<div th:replace="core/admin-lte-3/workspace/ocp_admin/report/script/day-leave-controller"></div>
<script th:inline="javascript">
    app.controller("adminReportController", ["$scope", "$http", ($scope, $http) => {

        $scope.mode = 'list';
        $scope.selectedReport;
        $scope.filter = 'all';
        $scope.isApproved = {};
        $scope.ocp_oc_reports = [
            {
                'id': '1', 'firstName': 'arin',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Center',
                'nickname': 'HR', 'type': 'วันทำงาน', 'date_work': '10/8/2023', 'date_report': '11/8/2023', 'time_report': '18.00 P.M.', 'ocp_leader': 'Approve', 'oc_leader': 'Approve', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '2', 'firstName': 'arin2',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'PGG',
                'nickname': 'HR', 'type': 'วันสลับวันหยุด', 'date_work': '12/8/2023', 'date_report': '12/8/2023', 'time_report': '19.00  P.M.', 'ocp_leader': 'Disapprove', 'oc_leader': 'Disapprove', 'ocp_awareness': 'Approve', 'oc_awareness': 'Disapprove',
            },
            {
                'id': '3', 'firstName': 'arin3',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Center',
                'nickname': 'HR', 'type': 'วันลา', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'Approve', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve', 'leave_type': 'ลากิจ', 'day_leave': '6/12/2023'

            },
            {
                'id': '4', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'KNOW - ARE',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '5', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'CCN',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '6', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Center',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '7', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'NxGn',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '8', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Fishsix',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '9', 'firstName': 'arin4',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'ESC',
                'nickname': 'HR', 'type': 'วันหยุด', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve',
            },
            {
                'id': '3', 'firstName': 'arin3',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Center',
                'nickname': 'HR', 'type': 'วันลา', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve', 'leave_type': 'ลากิจ', 'day_leave': '6/12/2023'

            },
            {
                'id': '3', 'firstName': 'arin3',
                'lastName': 'salabsi',
                'email': "techanddata@knoware.com",
                'business': 'Center',
                'nickname': 'HR', 'type': 'วันลา', 'date_work': '13/8/2023', 'date_report': '13/8/2023', 'time_report': '17.00 P.M.', 'ocp_leader': 'waiting', 'oc_leader': 'waiting', 'ocp_awareness': 'Approve', 'oc_awareness': 'Approve', 'leave_type': 'ลากิจ', 'day_leave': '6/12/2023'

            },
        ]

        $scope.businesses = [
            { text: "Center" },
            { text: "KNOW - ARE" },
            { text: "Fishsix" },
            { text: "ESC" },
            { text: "CCN" },
            { text: "NxGn" },
            { text: "PGG" }
        ]
        $scope.statuses = [
            { text: "Approve" },
            { text: "Disapprove" },
            { text: "Waiting" },
            { text: "Edited" },
            { text: "All" },

        ]

        $scope.work_types = [
            { 'id': '0', 'type': 'ทั้งหมด ' },
            { 'id': '1', 'type': 'วันทำงาน' },
            { 'id': '2', 'type': 'วันทำงานที่ใช้ชั่วโมงสะสมด้วย' },
            { 'id': '3', 'type': 'วันหยุดประจำสัปดาห์' },
            { 'id': '4', 'type': 'วันหยุดนักขัตฤกษ์' },
            { 'id': '5', 'type': 'วันหยุดแต่ทำงาน (เพราะสลับวันหยุด)' },
            { 'id': '6', 'type': 'วันหยุดแต่ทำงาน (เพราะสะสมชั่วโมง)' },
            { 'id': '7', 'type': 'ลากิจแบบใช้สิทธิ์ลากิจ' },
            { 'id': '8', 'type': 'ลากิจแบบใช้ชั่วโมงสะสม' },
            { 'id': '9', 'type': 'ลากิจแบบ Leave without pay (LWOP)' },
            { 'id': '10', 'type': 'วันลากิจแบบสลับวันหยุด' },
            { 'id': '11', 'type': 'วันลาป่วยแบบใช้สิทธิ์ลาป่วย' },
            { 'id': '12', 'type': 'วันลาป่วยแบบใช้ชั่วโมงสะสม' },
            { 'id': '13', 'type': 'ลาป่วยแบบ Leave without pay (LWOP)' },
            { 'id': '14', 'type': 'ลาพักร้อน' },
        ];

        $scope.init = function () {
            console.log("report start");
            $('.select2').select2({ theme: 'bootstrap4' });
            useApi($scope, $http);
            dayLeaveController($scope, $http);

        };

        $scope.toListMode = function () {
            $scope.mode = 'list'
            $scope.selectedReport = null;

        };

        $scope.viewReport = function (report) {
            $scope.selectedReport = report;
            $scope.mode = 'detail';
        };

        $scope.onButtonGroupClick = function ($event, name) {
            let clickedElement = $event.target || $event.srcElement;

            if (clickedElement.nodeName === "BUTTON") {
                if (clickedElement.id == 'approve') {
                    $scope.isApproved[name] = true;
                }
                else if (clickedElement.id == 'disapprove') {
                    $scope.isApproved[name] = false;
                }

                console.log($scope.isApproved)

                let isCertainButtonAlreadyActive = clickedElement.parentElement.querySelector(".active");

                if (isCertainButtonAlreadyActive) {
                    isCertainButtonAlreadyActive.classList.remove("active");
                }

                clickedElement.className += " active";
            }

        };
        //leader 
        $scope.approveLeader = function (report) {
            console.log(report.ocp_leader);
            if (report.ocp_leader == 'waiting' || report.ocp_leader == 'Disapprove') {
                report.ocp_leader = 'Approve';
                if (report.type == 'วันลา') { report.oc_leader = 'Approve'; }
            } else if (report.ocp_leader === 'Approve') {
                report.ocp_leader = 'waiting';
                if (report.type == 'วันลา') { report.oc_leader = 'waiting'; }
            }
            else {
                return '';
            }
        };

        $scope.disapproveLeader = function (report) {
            if (report.ocp_leader == 'waiting' || report.ocp_leader == 'Approve') {
                report.ocp_leader = 'Disapprove';
                if (report.type == 'วันลา') { report.oc_leader = 'Disapprove'; }
            } else if (report.ocp_leader === 'Disapprove') {
                report.ocp_leader = 'waiting';
                if (report.type == 'วันลา') { report.oc_leader = 'waiting'; }
            }
            else {
                return '';
            }
        };

        //awareness
        $scope.approveAwareness = function (report) {
            console.log(report.ocp_leader);
            if (report.ocp_awareness == 'waiting' || report.ocp_awareness == 'Disapprove') {
                report.ocp_awareness = 'Approve';
                if (report.type == 'วันลา') { report.oc_awareness = 'Approve'; }
            } else if (report.ocp_awareness === 'Approve') {
                report.ocp_awareness = 'waiting';
                if (report.type == 'วันลา') { report.oc_awareness = 'waiting'; }
            }
            else {
                return '';
            }
        };

        $scope.disapproveAwareness = function (report) {
            if (report.ocp_awareness == 'waiting' || report.ocp_awareness == 'Approve') {
                report.ocp_awareness = 'Disapprove';
                if (report.type == 'วันลา') { report.oc_awareness = 'Disapprove'; }
            } else if (report.ocp_awareness === 'Disapprove') {
                report.ocp_awareness = 'waiting';
                if (report.type == 'วันลา') { report.oc_awareness = 'waiting'; }
            }
            else {
                return '';
            }
        };


        $scope.getButtonClass = function (ocp_leader) {
            if (ocp_leader === 'Approve') {
                return 'bgApprove';
            } else if (ocp_leader === 'Disapprove') {
                return 'bgDisapprove';
            } else if (ocp_leader === 'waiting') {
                return 'bgWait';
            } else {
                return '';
            }
        };

    }]);
</script>